---
export interface Props {
  title?: string;
  showLogout?: boolean;
}

const {
  title = "Administrácia",
  showLogout = true,
} = Astro.props;
---

<header class="bg-[#1f2937] text-white shadow-xl sticky top-0 z-50">
  <div class="max-w-300 mx-auto px-4 h-16 md:h-20 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <a href="/" class="bg-white p-1.5 rounded-lg shadow-sm inline-flex items-center">
        <img src="/images/brand/logo.png" alt="Logo" class="h-7 md:h-9 w-auto" />
      </a>

      <div class="hidden sm:block h-8 w-px bg-white/10 mx-2"></div>

      <div class="flex flex-col">
        <span class="text-base md:text-lg font-black uppercase tracking-widest text-[#60a5fa] truncate">
          {title}
        </span>
        <span class="text-[10px] text-white/40 font-semibold mt-0.5 hidden md:inline">Administrátorský panel</span>
      </div>
    </div>

    <nav class="flex items-center gap-3">
      <a
        href="/admin/offers"
        class="text-sm text-white/90 hover:text-white px-3 py-2 rounded-md no-underline font-medium transition-colors"
      >Ponuky</a>

      <a
        href="/admin/messages"
        class="text-sm text-white/90 hover:text-white px-3 py-2 rounded-md no-underline font-medium transition-colors"
      >Správy</a>

      <a
        href="/"
        class="hidden md:inline text-sm text-white/90 hover:text-white px-3 py-2 rounded-md no-underline font-medium transition-colors"
      >Návšteva webu</a>

      {showLogout &&
        <button
          id="admin-logout-btn"
          class="ml-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-xs font-black uppercase rounded-xl transition-all active:scale-95 hidden"
          style="display: none;"
        >
          Odhlásiť
        </button>
      }
    </nav>
  </div>
</header>

<script>
  // Show logout button only when server reports admin is authenticated,
  // then wire logout behavior.
  (async function () {
    const btn = document.getElementById("admin-logout-btn");
    if (!btn) return;

    // Hide by default (already hidden via inline style/class); keep hidden until check passes.
    try {
      const res = await fetch("/admin/check", { credentials: "same-origin" });
      if (res.ok) {
        // endpoint returns boolean JSON true/false
        const isAuth = await res.json();
        if (isAuth) {
          // reveal the button
          btn.style.display = "";
          btn.classList.remove("hidden");
        } else {
          // ensure hidden if not authenticated
          btn.style.display = "none";
          btn.classList.add("hidden");
        }
      }
    } catch (e) {
      // network error — keep button hidden
      btn.style.display = "none";
      btn.classList.add("hidden");
    }

    // Attach logout handler regardless; if button is hidden user can't click it.
    btn.addEventListener("click", async (e) => {
      e.preventDefault();
      try {
        await fetch("/admin/logout", { method: "POST", credentials: "same-origin" });
      } catch (err) {
        // ignore network errors
      } finally {
        window.location.href = "/admin/login";
      }
    });
  })();
</script>
