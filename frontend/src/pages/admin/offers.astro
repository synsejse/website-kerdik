---
import AdminLayout from "../../layouts/admin/Layout.astro";
import Trash from "../../components/icons/Trash.astro";
import Edit from "../../components/icons/Edit.astro";
import ArrowsRotate from "../../components/icons/ArrowsRotate.astro";
import Loading from "../../components/admin/common/Loading.astro";
import EmptyState from "../../components/admin/common/EmptyState.astro";
import Modal from "../../components/admin/common/Modal.astro";

const TRASH_ICON = `<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
</svg>`;

const EDIT_ICON = `<svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
</svg>`;
---

<AdminLayout title="Admin - Ponuky" showFooter={false}>
  <div class="min-h-screen bg-gray-50 flex flex-col font-sans">
    <main class="grow py-8 md:py-12 px-4">
      <div class="max-w-275 mx-auto">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-6 mb-10 md:mb-12">
          <div>
            <h1 class="m-0 text-3xl md:text-4xl font-black text-gray-900 tracking-tight relative inline-block pb-3 after:content-[''] after:absolute after:left-0 after:bottom-0 after:h-2 after:w-2/3 after:bg-linear-to-r after:from-primary after:to-blue-400 after:rounded-full">
              Zoznam ponúk
            </h1>
            <p class="mt-4 text-xs text-gray-500 font-bold uppercase tracking-widest italic">
              Prehľad ponúk
            </p>
          </div>
          <div class="flex gap-3 items-center">
            <button id="refresh-btn" class="px-6 py-3 bg-primary hover:bg-[#0353e9] text-white font-black uppercase tracking-widest text-xs rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl active:scale-95 flex items-center gap-2 group">
              <ArrowsRotate class="h-4 w-4 transition-transform duration-500 group-hover:rotate-180" />
              Obnoviť zoznam
            </button>
            <button id="add-offer-btn" class="px-6 py-3 bg-primary hover:bg-[#0353e9] text-white font-black uppercase tracking-widest text-xs rounded-xl transition-all shadow-lg hover:shadow-xl active:scale-95">
              + Pridať ponuku
            </button>
          </div>
        </div>

        <div id="loading" class="hidden">
          <Loading text="Načítavam dáta..." />
        </div>

        <div id="offers-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

        <div id="no-offers" class="hidden">
          <EmptyState
            title="Zatiaľ žiadne ponuky."
            subtitle=""
          />
        </div>
      </div>
    </main>

    <Modal id="modal-overlay" title="Nová Ponuka">
      <form id="offer-form" class="space-y-4">
        <input type="hidden" id="offer-id" />
        <input
          type="text"
          id="offer-title"
          required
          class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:border-primary focus:ring-4 focus:ring-primary/10 outline-none font-bold"
          placeholder="Názov ponuky"
        />
        <input
          type="text"
          id="offer-slug"
          required
          class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:border-primary focus:ring-4 focus:ring-primary/10 outline-none font-mono text-sm"
          placeholder="slug-adresy"
        />
        <textarea
          id="offer-desc"
          rows="4"
          class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:border-primary focus:ring-4 focus:ring-primary/10 outline-none text-sm"
          placeholder="Popis..."
        ></textarea>

        <div>
          <label class="block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1">
            Externý odkaz (voliteľné)
          </label>
          <input
            type="url"
            id="offer-link"
            class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:border-primary focus:ring-4 focus:ring-primary/10 outline-none text-sm"
            placeholder="https://example.com"
          />
        </div>

        <div>
          <label class="block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1">
            Obrázok (PNG/JPG)
          </label>
          <input
            type="file"
            id="offer-image"
            accept="image/*"
            class="w-full text-xs text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-blue-50 file:text-primary"
          />
          <div id="image-preview" class="mt-3 hidden rounded-lg overflow-hidden border border-gray-200 h-24 w-full">
            <img src="" class="w-full h-full object-cover" alt="Náhľad obrázka" />
          </div>
        </div>

        <div class="pt-4 flex justify-end gap-3">
          <button type="button" id="modal-cancel" class="px-4 py-2 text-xs font-bold uppercase tracking-widest text-gray-500 hover:text-gray-700 transition-colors">
            Zrušiť
          </button>
          <button type="submit" class="px-6 py-2.5 bg-primary text-white text-xs font-black uppercase tracking-widest rounded-xl hover:bg-[#0353e9] transition-all shadow-lg hover:shadow-xl active:scale-95">
            Uložiť
          </button>
        </div>
      </form>
    </Modal>
  </div>

  <script>
    import { initializeOffersPage } from "../../lib/admin/offers";

    const elements = {
      container: document.getElementById("offers-container") as HTMLElement | null,
      loading: document.getElementById("loading") as HTMLElement | null,
      noOffers: document.getElementById("no-offers") as HTMLElement | null,
      form: document.getElementById("offer-form") as HTMLFormElement | null,
      modal: document.getElementById("modal-overlay") as HTMLElement | null,
      refreshBtn: document.getElementById("refresh-btn") as HTMLElement | null,
      addOfferBtn: document.getElementById("add-offer-btn") as HTMLElement | null,
      modalClose: document.getElementById("modal-overlay-close") as HTMLElement | null,
      modalCancel: document.getElementById("modal-cancel") as HTMLElement | null,
      offerId: document.getElementById("offer-id") as HTMLInputElement | null,
      offerTitle: document.getElementById("offer-title") as HTMLInputElement | null,
      offerSlug: document.getElementById("offer-slug") as HTMLInputElement | null,
      offerDesc: document.getElementById("offer-desc") as HTMLTextAreaElement | null,
      offerLink: document.getElementById("offer-link") as HTMLInputElement | null,
      offerImage: document.getElementById("offer-image") as HTMLInputElement | null,
      imagePreview: document.getElementById("image-preview") as HTMLElement | null,
      imagePreviewImg: document.querySelector("#image-preview img") as HTMLImageElement | null,
    };

    initializeOffersPage(elements);
  </script>
</AdminLayout>
